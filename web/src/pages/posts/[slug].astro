---
import Layout from '../../layouts/Layout.astro';
import Sidebar from '../../components/Sidebar.astro';
import { sanityClient } from '../../lib/sanity';
import { PortableText } from '@portabletext/react';

export async function getStaticPaths() {
  const posts = await sanityClient.fetch(`*[_type == "post" && defined(slug.current)] { "slug": slug.current }`);
  return posts.map((post) => ({ params: { slug: post.slug } }));
}

const { slug } = Astro.params;
const post = await sanityClient.fetch(`*[_type == "post" && slug.current == $slug][0] {
  title,
  "image": mainImage.asset->url,
  "category": categories[0]->title,
  publishedAt,
  body
}`, { slug });

if (!post) return Astro.redirect('/404');
---

<Layout title={post.title} image={post.image}>
  <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 pt-4 px-4 md:px-0">
    <article class="lg:col-span-8">
      <header class="mb-8">
        <h1 class="text-3xl md:text-5xl font-heading font-bold text-bj-white leading-tight mb-6 uppercase">{post.title}</h1>
        <div class="border-y border-white/5 py-4 text-bj-dim text-xs uppercase tracking-widest">
            {post.category || 'Notícia'} | {post.publishedAt ? new Date(post.publishedAt).toLocaleDateString('pt-BR') : 'Hoje'}
        </div>
      </header>

      {post.image && (
        <div class="aspect-video w-full mb-10 rounded-sm overflow-hidden border border-white/5 shadow-2xl">
            <img src={post.image} alt={post.title} class="w-full h-full object-cover" />
        </div>
      )}

      <div class="prose prose-invert prose-lg max-w-none text-bj-gray mb-12">
        {post.body ? <PortableText value={post.body} /> : <p>Conteúdo indisponível.</p>}
      </div>

      <div class="my-10 w-full flex justify-center">
         <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5066122308491062" data-ad-slot="4803145127" data-ad-format="auto" data-full-width-responsive="true"></ins>
         <script is:inline>(adsbygoogle = window.adsbygoogle || []).push({});</script>
      </div>
    </article>
    <aside class="lg:col-span-4"><Sidebar /></aside>
  </div>
</Layout>