---
import Layout from '../../layouts/Layout.astro';
import Sidebar from '../../components/Sidebar.astro';
import { sanityClient } from '../../lib/sanity';

export async function getStaticPaths() {
  return [
    { params: { category: 'brasileirao', subcategory: 'pre-jogo' }, props: { name: 'Pré Jogo' } },
    { params: { category: 'brasileirao', subcategory: 'analises' }, props: { name: 'Bola Cheia / Bola Murcha' } },
    { params: { category: 'brasileirao', subcategory: 'ultimas' }, props: { name: 'Últimas do Brasileirão' } },
    { params: { category: 'so-lendas', subcategory: 'craques' }, props: { name: 'Craques do Passado' } },
    { params: { category: 'so-lendas', subcategory: 'curiosidades' }, props: { name: 'Curiosidades Históricas' } },
    { params: { category: 'olho-no-lance', subcategory: 'tatica' }, props: { name: 'Formação Tática' } },
    { params: { category: 'olho-no-lance', subcategory: 'entendendo' }, props: { name: 'Entendendo o Futebol' } },
  ];
}

const { category, subcategory } = Astro.params;
const { name } = Astro.props;

// BUSCA OS POSTS REAIS NO SANITY
const posts = await sanityClient.fetch(`
  *[_type == "post" && defined(slug.current) && $category in categories[]->slug.current] | order(publishedAt desc) {
    title,
    "slug": slug.current,
    "image": mainImage.asset->url,
    "excerpt": pt::text(body)
  }
`, { category });
---

<Layout title={`${name} | ${category}`}>
    <div class="w-full max-w-[1200px] mx-auto mt-4 mb-8 flex justify-center px-4">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-5066122308491062"
             data-ad-slot="4803145127"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script is:inline>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

    <div class="py-12 mb-8 border-b border-white/5 bg-bj-surface/30">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex items-center gap-2 text-xs text-bj-dim uppercase tracking-wider mb-2">
                <a href="/" class="hover:text-bj-neon">Home</a>
                <span>/</span>
                <span class="text-bj-neon">{name}</span>
            </div>
            <h1 class="text-4xl md:text-5xl font-heading font-bold text-bj-white uppercase">
                {name}
            </h1>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 max-w-7xl mx-auto px-4">
        <div class="lg:col-span-8 space-y-8">
            {posts.length > 0 ? (
                posts.map((post) => (
                    <article class="flex flex-col md:flex-row gap-6 bg-bj-surface border border-white/5 p-4 rounded-sm hover:border-bj-neon/30 transition-colors group">
                        <a href={`/posts/${post.slug}`} class="w-full md:w-1/3 aspect-video overflow-hidden relative block">
                            {post.image ? (
                                <img src={post.image} alt={post.title} class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105" />
                            ) : (
                                <div class="w-full h-full bg-gray-800 flex items-center justify-center text-xs text-gray-500">Sem imagem</div>
                            )}
                        </a>
                        <div class="flex-1 flex flex-col justify-center">
                            <span class="text-bj-neon text-xs font-bold uppercase mb-2">{name}</span>
                            <h2 class="text-xl font-heading font-bold text-bj-white leading-tight mb-3 group-hover:text-bj-neon transition-colors">
                                <a href={`/posts/${post.slug}`}>{post.title}</a>
                            </h2>
                            <p class="text-bj-dim text-sm mb-4 line-clamp-3">
                                {post.excerpt ? post.excerpt.substring(0, 150) + "..." : "Clique para ler a matéria completa."}
                            </p>
                        </div>
                    </article>
                ))
            ) : (
                <div class="p-8 text-center border border-dashed border-white/10 rounded">
                    <p class="text-bj-dim">Nenhuma notícia encontrada nesta categoria no momento.</p>
                </div>
            )}
        </div>
        <aside class="lg:col-span-4">
            <Sidebar />
        </aside>
    </div>
</Layout>